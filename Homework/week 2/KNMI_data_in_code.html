<!DOCTYPE html>

<html>
    <head>
        <title>Homework week 2</title>
        <style type="text/css">
            canvas { border: 1px solid black; }
        </style>
    </head>
    <body onload="draw();">
        <textarea id="rawdata" style="display:none;">
          # date,maxtemp
          20160101,   75
          20160102,   63
          20160103,   82
          20160104,   70
          20160105,   77
          20160106,   47
          20160107,   79
          20160108,   83
          20160109,   79
          20160110,   90
          20160111,   67
          20160112,   72
          20160113,   70
          20160114,   53
          20160115,   40
          20160116,   56
          20160117,   30
          20160118,    0
          20160119,    7
          20160120,   53
          20160121,   15
          20160122,   57
          20160123,   90
          20160124,  104
          20160125,  146
          20160126,  111
          20160127,  124
          20160128,   90
          20160129,  100
          20160130,   99
          20160131,  108
          20160201,  119
          20160202,  114
          20160203,   70
          20160204,   77
          20160205,  109
          20160206,  106
          20160207,  111
          20160208,   99
          20160209,   82
          20160210,   83
          20160211,   83
          20160212,   66
          20160213,   44
          20160214,   26
          20160215,   56
          20160216,   61
          20160217,   35
          20160218,   31
          20160219,   83
          20160220,  111
          20160221,  116
          20160222,  113
          20160223,   79
          20160224,   65
          20160225,   54
          20160226,   55
          20160227,   63
          20160228,   66
          20160229,   67
          20160301,   86
          20160302,   90
          20160303,   84
          20160304,   32
          20160305,   64
          20160306,   73
          20160307,   78
          20160308,   83
          20160309,   81
          20160310,   92
          20160311,   85
          20160312,  101
          20160313,   99
          20160314,  104
          20160315,   83
          20160316,   90
          20160317,  120
          20160318,   68
          20160319,   75
          20160320,   96
          20160321,   93
          20160322,  101
          20160323,  101
          20160324,   99
          20160325,   96
          20160326,  149
          20160327,  133
          20160328,  129
          20160329,  112
          20160330,  117
          20160331,  116
          20160401,  130
          20160402,  134
          20160403,  204
          20160404,  158
          20160405,  133
          20160406,  117
          20160407,  104
          20160408,  115
          20160409,  149
          20160410,  157
          20160411,  182
          20160412,  167
          20160413,  158
          20160414,  167
          20160415,  141
          20160416,  118
          20160417,  106
          20160418,  130
          20160419,  136
          20160420,  138
          20160421,  166
          20160422,  125
          20160423,   93
          20160424,   88
          20160425,   80
          20160426,   77
          20160427,  107
          20160428,   93
          20160429,  106
          20160430,  112
          20160501,  141
          20160502,  179
          20160503,  140
          20160504,  160
          20160505,  188
          20160506,  236
          20160507,  258
          20160508,  252
          20160509,  253
          20160510,  221
          20160511,  255
          20160512,  251
          20160513,  222
          20160514,  121
          20160515,  121
          20160516,  136
          20160517,  181
          20160518,  187
          20160519,  173
          20160520,  186
          20160521,  234
          20160522,  190
          20160523,  133
          20160524,  146
          20160525,  145
          20160526,  193
          20160527,  209
          20160528,  227
          20160529,  205
          20160530,  180
          20160531,  226
          20160601,  243
          20160602,  172
          20160603,  214
          20160604,  275
          20160605,  256
          20160606,  256
          20160607,  265
          20160608,  216
          20160609,  203
          20160610,  212
          20160611,  208
          20160612,  211
          20160613,  190
          20160614,  191
          20160615,  187
          20160616,  211
          20160617,  195
          20160618,  171
          20160619,  189
          20160620,  168
          20160621,  201
          20160622,  249
          20160623,  284
          20160624,  227
          20160625,  193
          20160626,  183
          20160627,  189
          20160628,  218
          20160629,  202
          20160630,  192
          20160701,  198
          20160702,  187
          20160703,  198
          20160704,  228
          20160705,  181
          20160706,  194
          20160707,  221
          20160708,  212
          20160709,  236
          20160710,  274
          20160711,  217
          20160712,  203
          20160713,  183
          20160714,  192
          20160715,  213
          20160716,  226
          20160717,  238
          20160718,  265
          20160719,  295
          20160720,  329
          20160721,  274
          20160722,  261
          20160723,  253
          20160724,  255
          20160725,  224
          20160726,  234
          20160727,  213
          20160728,  235
          20160729,  212
          20160730,  209
          20160731,  205
          20160801,  210
          20160802,  186
          20160803,  217
          20160804,  208
          20160805,  216
          20160806,  224
          20160807,  228
          20160808,  205
          20160809,  185
          20160810,  168
          20160811,  163
          20160812,  226
          20160813,  215
          20160814,  217
          20160815,  217
          20160816,  210
          20160817,  234
          20160818,  242
          20160819,  243
          20160820,  229
          20160821,  198
          20160822,  227
          20160823,  269
          20160824,  302
          20160825,  310
          20160826,  262
          20160827,  265
          20160828,  246
          20160829,  214
          20160830,  238
          20160831,  254
          20160901,  229
          20160902,  217
          20160903,  229
          20160904,  213
          20160905,  228
          20160906,  242
          20160907,  268
          20160908,  276
          20160909,  229
          20160910,  257
          20160911,  217
          20160912,  281
          20160913,  312
          20160914,  314
          20160915,  290
          20160916,  212
          20160917,  216
          20160918,  207
          20160919,  198
          20160920,  200
          20160921,  207
          20160922,  213
          20160923,  203
          20160924,  236
          20160925,  243
          20160926,  191
          20160927,  204
          20160928,  216
          20160929,  177
          20160930,  187
          20161001,  176
          20161002,  157
          20161003,  190
          20161004,  173
          20161005,  141
          20161006,  127
          20161007,  145
          20161008,  142
          20161009,  145
          20161010,  135
          20161011,  131
          20161012,  110
          20161013,  114
          20161014,  134
          20161015,  137
          20161016,  188
          20161017,  163
          20161018,  128
          20161019,  120
          20161020,  120
          20161021,  127
          20161022,  104
          20161023,  116
          20161024,   95
          20161025,  101
          20161026,  126
          20161027,  138
          20161028,  148
          20161029,  154
          20161030,  153
          20161031,  162
          20161101,  138
          20161102,  117
          20161103,  120
          20161104,   97
          20161105,  108
          20161106,   93
          20161107,   57
          20161108,   56
          20161109,   43
          20161110,   52
          20161111,   58
          20161112,   50
          20161113,   47
          20161114,   69
          20161115,  129
          20161116,  142
          20161117,  115
          20161118,   82
          20161119,   81
          20161120,  125
          20161121,  139
          20161122,  136
          20161123,  111
          20161124,   87
          20161125,   84
          20161126,   36
          20161127,   94
          20161128,   42
          20161129,   43
          20161130,   68
          20161201,   94
          20161202,   94
          20161203,   81
          20161204,   40
          20161205,   41
          20161206,   54
          20161207,   95
          20161208,   96
          20161209,  104
          20161210,   92
          20161211,   96
          20161212,   76
          20161213,   75
          20161214,   91
          20161215,   79
          20161216,   75
          20161217,   85
          20161218,   91
          20161219,   75
          20161220,   10
          20161221,   71
          20161222,   69
          20161223,   80
          20161224,   97
          20161225,  117
          20161226,  118
          20161227,   93
          20161228,   43
          20161229,   -8
          20161230,   15
          20161231,   33
        </textarea>
        <p>
            <canvas id="myCanvas" width="516" height="487"></canvas>
        </p>
        <script>
          // data ophalen en in lijnen opslitsen
          var data = document.getElementById("rawdata").value.split("\n");

          // door de lijnen itereren en in datum en temperatuur opslitsen
          dataDatum = []
          dataTemp = []
          for (var i = 0; i < data.length-1; i++)
          {
              var lijn = data[i].split(",")
              dataDatum.push(lijn[0].trim(" "))
              dataTemp.push(lijn[1].trim(" "))
          }

          // datum en temperatuur omzetten in JavaScript datums en nummers
          javaDatum = []
          javaTemp = []
          for (var i = 1; i < dataDatum.length; i++)
          {
            var jaar = dataDatum[i].slice(0, 4)
            var maand = dataDatum[i].slice(4, 6)
            var dag = dataDatum[i].slice(6, 8)
            javaDatum.push(new Date(jaar, maand - 1, dag, 0, 0, 0, 0))
            javaTemp.push(Number(dataTemp[i]))
          }

          // schermgrootte defineren
          var grens = 75
          var hoogte = document.getElementById("myCanvas")["height"]
          var breedte = document.getElementById("myCanvas")["width"]
          var bereikDatum = [0, breedte - (2 * grens)]
          var bereikTemp = [0, hoogte - (2 * grens)]

          // datums omzetten naar milliseconde
          var milliseconde = []
          for (var i = 0; i < javaDatum.length; i++)
          {
            milliseconde.push(javaDatum[i].getTime())
          }

          // bereken nieuwe waarden voor datums
          var domeinDatum = [Math.min(...milliseconde), Math.max(...milliseconde)]
          var veranderDatum = createTransform(domeinDatum, bereikDatum)
          var puntenDatum = []
          for (var i = 0; i < milliseconde.length; i++)
          {
            puntenDatum.push(veranderDatum(milliseconde[i]))
          }

          // bereken nieuwe waarden voor temperatuur
          var domeinTemp = [Math.min(...javaTemp), Math.max(...javaTemp)]
          var veranderTemp = createTransform(domeinTemp, bereikTemp)
          var puntenTemp = []
          for (var i = 0; i < javaTemp.length; i++)
          {
            puntenTemp.push(veranderTemp(javaTemp[i]))
          }

          // bererekenen van alfa en beta
          function createTransform(domain, range)
          {
            var domain_min = domain[0]
            var domain_max = domain[1]
            var range_min = range[0]
            var range_max = range[1]
            // formules voor het berekenen van de alpha en de beta
           	var alpha = (range_max - range_min) / (domain_max - domain_min)
            var beta = range_max - alpha * domain_max
            // returns de functie voor de lineaire transformatie (y= a * x + b)
            return function(x)
            {
              return alpha * x + beta;
            }
          }

          function draw()
          {
            var canvas = document.getElementById("myCanvas")
            if (canvas.getContext)
            {
              var ctx = canvas.getContext("2d")

              var bereikTemp = Math.abs(domeinTemp[0]) + domeinTemp[1]
              var aantalDagen = milliseconde.length

              // teken x-as
              ctx.beginPath()
              ctx.moveTo(grens, grens + bereikTemp)
              ctx.lineTo(grens + aantalDagen, grens + bereikTemp)
              ctx.stroke()
              ctx.closePath()

              // teken y-as
              ctx.beginPath()
              ctx.moveTo(grens, grens - 13)
              ctx.lineTo(grens, grens + bereikTemp)
              ctx.stroke()
              ctx.closePath()


              // stapgrootte aan x-as toevoegen
              var count = 30
              for (var i = 0, maanden = 12; i < maanden; i++)
              {
                ctx.moveTo(grens + count, grens + bereikTemp + 3)
                ctx.lineTo(grens + count, grens + bereikTemp)
                ctx.stroke()
                count += 30.5
              }

              // waarden aan x-as toevoegen
              ctx.beginPath()
              ctx.font = "12px serif"
              ctx.fillText("jan", grens + 10, grens + bereikTemp + 15)
              ctx.fillText("feb", grens + 40, grens + bereikTemp + 15)
              ctx.fillText("mrt", grens + 70, grens + bereikTemp + 15)
              ctx.fillText("apr", grens + 100, grens + bereikTemp + 15)
              ctx.fillText("mei", grens + 130, grens + bereikTemp + 15)
              ctx.fillText("jun", grens + 160, grens + bereikTemp + 15)
              ctx.fillText("jul", grens + 190, grens + bereikTemp + 15)
              ctx.fillText("aug", grens + 220, grens + bereikTemp + 15)
              ctx.fillText("sep", grens + 250, grens + bereikTemp + 15)
              ctx.fillText("okt", grens + 280, grens + bereikTemp + 15)
              ctx.fillText("nov", grens + 310, grens + bereikTemp + 15)
              ctx.fillText("dec", grens + 340, grens + bereikTemp + 15)
              ctx.closePath

              // waarden en stapgrootte aan y-as toevoegen
              var count = Math.abs(domeinTemp[0])
              for (var i = 0, n = 7; i < n; i++)
              {
                ctx.moveTo(grens - 3, grens + bereikTemp - count)
                ctx.lineTo(grens, grens + bereikTemp - count)
                ctx.stroke()
                ctx.font = "12px serif"
                ctx.fillText(count - Math.abs(domeinTemp[0]), grens - 25, bereikTemp + grens - count);
                count += 50
              }

              // punten in de grafiek toevoegen
              ctx.beginPath()
              ctx.lineWidth = 0.8
              ctx.strokeStyle = "blue";
              ctx.moveTo(grens + puntenDatum[0], puntenTemp[0])
              for (var i = 0; i < milliseconde.length; i++)
              {
                ctx.lineTo(grens + puntenDatum[i], hoogte - puntenTemp[i] - grens)
              }
              ctx.stroke()
              ctx.closePath()

              // titel toevoegen
              ctx.beginPath()
              ctx.font = "25px serif"
              ctx.fillText("Maximum temperatuur 2014 De Bilt", grens + 10, 20)
              ctx.font = "14px serif"
              ctx.fillText("KONINKLIJK NEDERLANDS METEOROLOGISCH INSTITUUT", grens, 40)
              ctx.closePath()

              // titel aan assen geven
              ctx.beginPath()
              ctx.font = "16px serif"
              ctx.fillText("Maanden", breedte - grens - 20, hoogte - 30)
              ctx.rotate(-Math.PI/2)
              ctx.fillText("Graden", - grens - 20, grens - 40)
              ctx.closePath()
            }
          }
        </script>
        <a href="http://projects.knmi.nl/klimatologie/daggegevens/selectie.cgi">Bron</a>
        <p> Linsey Schaap (11036109) </p>
        <p> Homework Week 2: JavaScript </p>
    </body>
</html>
